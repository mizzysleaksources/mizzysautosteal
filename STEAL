--// AUTO STEAL (ALWAYS ON + FADE + TEXT + % + PURPLE THEME + NOTIFIER)

local CONFIG = {
    AUTO_STEAL_PROX_RADIUS = 20,
}

--// Services
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local TweenService = game:GetService("TweenService")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

--// State
local allAnimalsCache = {}
local PromptMemoryCache = {}
local InternalStealCache = {}

local IsStealing = false
local StealProgress = 0
local CurrentDistance = CONFIG.AUTO_STEAL_PROX_RADIUS

--// Character
local function getHRP()
    local c = LocalPlayer.Character
    return c and (c:FindFirstChild("HumanoidRootPart") or c:FindFirstChild("UpperTorso"))
end

--// Base check
local function isMyBase(plotName)
    local plot = workspace.Plots:FindFirstChild(plotName)
    local sign = plot and plot:FindFirstChild("PlotSign")
    local yourBase = sign and sign:FindFirstChild("YourBase")
    return yourBase and yourBase:IsA("BillboardGui") and yourBase.Enabled
end

--// Scan plots
local function scanPlots()
    table.clear(allAnimalsCache)
    for _, plot in ipairs(workspace.Plots:GetChildren()) do
        if plot:IsA("Model") and not isMyBase(plot.Name) then
            local podiums = plot:FindFirstChild("AnimalPodiums")
            if podiums then
                for _, podium in ipairs(podiums:GetChildren()) do
                    if podium:IsA("Model") and podium:FindFirstChild("Base") then
                        table.insert(allAnimalsCache, {
                            plot = plot.Name,
                            slot = podium.Name,
                            worldPosition = podium:GetPivot().Position,
                            uid = plot.Name .. "_" .. podium.Name,
                        })
                    end
                end
            end
        end
    end
end

task.delay(2, function()
    scanPlots()
    while task.wait(5) do scanPlots() end
end)

--// Prompt lookup
local function getPrompt(a)
    local cached = PromptMemoryCache[a.uid]
    if cached and cached.Parent then return cached end

    local attach =
        workspace.Plots[a.plot]
        .AnimalPodiums[a.slot]
        .Base.Spawn:FindFirstChild("PromptAttachment")

    if not attach then return end
    for _, p in ipairs(attach:GetChildren()) do
        if p:IsA("ProximityPrompt") then
            PromptMemoryCache[a.uid] = p
            return p
        end
    end
end

--// Build internal callbacks
local function build(prompt)
    if InternalStealCache[prompt] then return end
    local d = { hold = {}, trigger = {}, ready = true }

    for _, c in ipairs(getconnections(prompt.PromptButtonHoldBegan)) do
        if type(c.Function) == "function" then
            table.insert(d.hold, c.Function)
        end
    end
    for _, c in ipairs(getconnections(prompt.Triggered)) do
        if type(c.Function) == "function" then
            table.insert(d.trigger, c.Function)
        end
    end

    InternalStealCache[prompt] = d
end

--// Steal
local function steal(prompt)
    local d = InternalStealCache[prompt]
    if not d or not d.ready then return end

    d.ready = false
    IsStealing = true
    StealProgress = 0

    task.spawn(function()
        for _, fn in ipairs(d.hold) do task.spawn(fn) end

        local t = tick()
        while tick() - t < 1.3 do
            StealProgress = (tick() - t) / 1.3
            task.wait()
        end

        StealProgress = 1
        for _, fn in ipairs(d.trigger) do task.spawn(fn) end

        task.wait(0.25)
        IsStealing = false
        StealProgress = 0
        d.ready = true
    end)
end

--// Nearest animal
local function getNearest()
    local hrp = getHRP()
    if not hrp then return end

    local best, dist = nil, math.huge
    for _, a in ipairs(allAnimalsCache) do
        local d = (hrp.Position - a.worldPosition).Magnitude
        if d < dist then best, dist = a, d end
    end
    return best, dist
end

--// ================= UI =================

local gui = Instance.new("ScreenGui", PlayerGui)
gui.Name = "AutoStealUI"
gui.ResetOnSpawn = false

--// Steal Bar
local bar = Instance.new("Frame", gui)
bar.Size = UDim2.new(0, 260, 0, 16)
bar.Position = UDim2.new(0.5, -130, 0, 8)
bar.BackgroundColor3 = Color3.fromRGB(20, 12, 30)
bar.BorderSizePixel = 0
Instance.new("UICorner", bar).CornerRadius = UDim.new(1, 0)

local stroke = Instance.new("UIStroke", bar)
stroke.Color = Color3.fromRGB(170, 120, 255)
stroke.Thickness = 1

local fill = Instance.new("Frame", bar)
fill.Size = UDim2.new(0, 0, 1, 0)
fill.BackgroundColor3 = Color3.fromRGB(185, 140, 255)
fill.BorderSizePixel = 0
Instance.new("UICorner", fill).CornerRadius = UDim.new(1, 0)

local grad = Instance.new("UIGradient", fill)
grad.Color = ColorSequence.new{
    ColorSequenceKeypoint.new(0, Color3.fromRGB(160, 120, 255)),
    ColorSequenceKeypoint.new(0.5, Color3.fromRGB(210, 170, 255)),
    ColorSequenceKeypoint.new(1, Color3.fromRGB(160, 120, 255)),
}

local text = Instance.new("TextLabel", bar)
text.Size = UDim2.new(1, 0, 1, 0)
text.BackgroundTransparency = 1
text.Font = Enum.Font.GothamBold
text.TextSize = 12
text.TextColor3 = Color3.fromRGB(240, 230, 255)
text.TextStrokeTransparency = 0.55

--// ================= LOAD NOTIFIER =================

local notify = Instance.new("Frame", gui)
notify.Size = UDim2.new(0, 320, 0, 60)
notify.Position = UDim2.new(0.5, -160, 0.15, 0)
notify.BackgroundColor3 = Color3.fromRGB(20, 12, 30)
notify.BackgroundTransparency = 1
notify.BorderSizePixel = 0
Instance.new("UICorner", notify).CornerRadius = UDim.new(0, 12)

local nStroke = Instance.new("UIStroke", notify)
nStroke.Color = Color3.fromRGB(170, 120, 255)
nStroke.Transparency = 1

local title = Instance.new("TextLabel", notify)
title.Size = UDim2.new(1, -20, 0, 28)
title.Position = UDim2.new(0, 10, 0, 6)
title.BackgroundTransparency = 1
title.Font = Enum.Font.GothamBold
title.TextSize = 16
title.TextColor3 = Color3.fromRGB(240, 230, 255)
title.TextTransparency = 1
title.Text = "Loaded Auto Steal Successfully"

local sub = Instance.new("TextLabel", notify)
sub.Size = UDim2.new(1, -20, 0, 18)
sub.Position = UDim2.new(0, 10, 0, 34)
sub.BackgroundTransparency = 1
sub.Font = Enum.Font.Gotham
sub.TextSize = 12
sub.TextColor3 = Color3.fromRGB(200, 180, 255)
sub.TextTransparency = 1
sub.Text = "Made by Mizzy"

--// Notifier animation
task.spawn(function()
    local fadeIn = TweenService:Create(notify, TweenInfo.new(0.4), {BackgroundTransparency = 0.1})
    local strokeIn = TweenService:Create(nStroke, TweenInfo.new(0.4), {Transparency = 0})
    local tIn = TweenService:Create(title, TweenInfo.new(0.4), {TextTransparency = 0})
    local sIn = TweenService:Create(sub, TweenInfo.new(0.4), {TextTransparency = 0})

    fadeIn:Play(); strokeIn:Play(); tIn:Play(); sIn:Play()
    task.wait(1.6)

    local fadeOut = TweenService:Create(notify, TweenInfo.new(0.4), {BackgroundTransparency = 1})
    local strokeOut = TweenService:Create(nStroke, TweenInfo.new(0.4), {Transparency = 1})
    local tOut = TweenService:Create(title, TweenInfo.new(0.4), {TextTransparency = 1})
    local sOut = TweenService:Create(sub, TweenInfo.new(0.4), {TextTransparency = 1})

    fadeOut:Play(); strokeOut:Play(); tOut:Play(); sOut:Play()
    task.wait(0.5)
    notify:Destroy()
end)

--// UI Update
task.spawn(function()
    while task.wait(0.03) do
        grad.Rotation += 1

        local fade = math.clamp(
            1 - (CurrentDistance / CONFIG.AUTO_STEAL_PROX_RADIUS),
            0.15, 1
        )

        bar.BackgroundTransparency = 1 - (0.85 * fade)
        stroke.Transparency = 1 - fade
        fill.BackgroundTransparency = 1 - fade
        text.TextTransparency = IsStealing and (1 - fade) or 1

        if IsStealing then
            fill.Size = UDim2.new(StealProgress, 0, 1, 0)
            text.Text = "GRABBINGâ€¦ " .. math.floor(StealProgress * 100) .. "%"
        else
            fill.Size = UDim2.new(math.max(0, fill.Size.X.Scale - 0.05), 0, 1, 0)
        end
    end
end)

--// Main loop
RunService.Heartbeat:Connect(function()
    if IsStealing then return end

    local animal, dist = getNearest()
    CurrentDistance = dist or CONFIG.AUTO_STEAL_PROX_RADIUS

    if not animal or dist > CONFIG.AUTO_STEAL_PROX_RADIUS then return end

    local prompt = getPrompt(animal)
    if prompt then
        build(prompt)
        steal(prompt)
    end
end)
A
